<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>IoT Monitoreo • Tiempo real</title>
  <link rel="icon" type="image/x-icon" href="../favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap + Chart.js -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>

  <style>
    :root{
      --radius: 20px;
      --bg: #020617;
      --card: #0b1120;
      --accent: #3b82f6;
      --accent-soft: rgba(59,130,246,0.18);
      --text: #e5e7eb;
      --text-muted: #9ca3af;
    }

    body{
      background: radial-gradient(circle at top, #1f2937, #020617);
      color: var(--text);
    }

    .navbar, footer{
      background: linear-gradient(90deg,#1d4ed8,#0f172a) !important;
      color:#e5e7eb;
      box-shadow:0 10px 30px rgba(15,23,42,.7);
    }

    .brand-gradient{
      background:linear-gradient(90deg,#38bdf8,#a855f7);
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
    }

    .card-ui{
      border-radius:var(--radius);
      background:var(--card);
      border:1px solid rgba(148,163,184,.28);
      box-shadow:0 18px 45px rgba(15,23,42,.75);
      color:var(--text);
    }

    .card-ui .text-muted{
      color:var(--text-muted) !important;
    }

    .status-dot{
      display:inline-block;
      width:.65rem;
      height:.65rem;
      border-radius:50%;
      margin-right:.4rem;
    }
    .status-ok{background:#22c55e;box-shadow:0 0 10px #22c55e;}
    .status-bad{background:#ef4444;box-shadow:0 0 10px #ef4444;}

    .fade-in{animation:fade .35s ease}
    @keyframes fade{
      from{opacity:0;transform:translateY(6px)}
      to{opacity:1;transform:none}
    }

    .table-dark td,.table-dark th{color:#fff}

    .badge-soft{
      background-color: var(--accent-soft);
      color: #bfdbfe;
      border:1px solid rgba(59,130,246,.7);
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
      <a class="navbar-brand fw-bold" href="../control/">
        <span class="brand-gradient">IoT Monitoreo</span>
      </a>
      <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#nav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div id="nav" class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link" href="../control/">Control</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="#">Monitoreo</a>
          </li>
          <li class="nav-item">
            <a id="wsState" class="nav-link">
              <span class="status-dot status-bad"></span>WS Reconectando…
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container py-4">
    <div class="row g-3 mb-3">
      <!-- Gráfica -->
      <div class="col-12 col-lg-7">
        <div class="card card-ui h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h5 class="m-0">Eventos por minuto (últimos 10)</h5>
              <span class="badge badge-soft" id="badgeTotal">0 eventos</span>
            </div>
            <canvas id="chart" height="110"></canvas>
          </div>
        </div>
      </div>

      <!-- KPIs -->
      <div class="col-12 col-lg-5">
        <div class="card card-ui h-100">
          <div class="card-body">
            <h5>KPIs</h5>
            <div class="row g-3">
              <div class="col-6">
                <div class="p-3 rounded-3" style="background:#111827;">
                  <div class="text-muted small">Último movimiento</div>
                  <div id="k-mov" class="fs-4 fw-bold text-info">—</div>
                </div>
              </div>
              <div class="col-6">
                <div class="p-3 rounded-3" style="background:#111827;">
                  <div class="text-muted small">Último obstáculo</div>
                  <div id="k-obs" class="fs-4 fw-bold text-warning">—</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tablas -->
    <div class="row g-3">
      <div class="col-12 col-lg-6">
        <div class="card card-ui h-100">
          <div class="card-body">
            <h5 class="mb-2">Stream en tiempo real</h5>
            <table class="table table-sm table-dark align-middle">
              <thead>
                <tr>
                  <th>TS</th>
                  <th>Tipo</th>
                  <th>Detalle</th>
                </tr>
              </thead>
              <tbody id="tb-live"></tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="col-12 col-lg-6">
        <div class="card card-ui h-100">
          <div class="card-body">
            <h5 class="mb-2">Últimos movimientos</h5>
            <table class="table table-sm table-dark align-middle">
              <thead>
                <tr>
                  <th>TS</th>
                  <th>Mov.</th>
                  <th>Disp.</th>
                </tr>
              </thead>
              <tbody id="tb-hist"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="py-3">
    <div class="container d-flex flex-column flex-sm-row justify-content-between">
      <span>© <span id="year"></span> Uriel Ahumada Huerta — Proyecto IoT</span>
      <span>Monitoreo en tiempo real</span>
    </div>
  </footer>

  <!-- Toasts -->
  <div id="toasts" class="position-fixed top-0 end-0 p-3"></div>

  <!-- Libs -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Script de la app -->
  <script src="./app.js"></script>
</body>
</html>